SELECT TO_CHAR(PCPREST.DTVENC, 'YYYY-MM-DD') AS DATAVENCIMENTO,
       PCPREST.CODFILIAL,
       CASE
           WHEN PCPREST.DTPAG IS NULL AND PCPREST.DTVENC < TRUNC(SYSDATE) THEN 'INADIMPLENTE'
           ELSE 'ADIMPLENTE'
           END                               AS INADIMPLENCIA,
       SUM(PCPREST.VALOR)                    AS VALORTITULO,
       SUM(PCPREST.VPAGO)                    AS VALORPAGO,
       SUM(PCPREST.TXPERM)                   AS VALORJUROS,
       SUM(PCPREST.VALORDESC)                AS VALORDESCONTO,
       SUM(CASE
               WHEN PCPREST.DTPAG IS NULL AND
                    PCPREST.CODCOB NOT IN ('DEVP', 'DEVT', 'BNF', 'BNFT', 'BNFR', 'BNTR', 'BNRP', 'CRED')
                   THEN PCPREST.VALOR - NVL(PCPREST.VALORDESC, 0)
               ELSE 0
           END)                              AS VALORARECEBER,
       SUM(PCPREST.VLTXBOLETO)               AS VLTXBOLETO
FROM PCPREST
GROUP BY TO_CHAR(PCPREST.DTVENC, 'YYYY-MM-DD'),
         PCPREST.CODFILIAL,
         CASE
             WHEN PCPREST.DTPAG IS NULL AND PCPREST.DTVENC < TRUNC(SYSDATE) THEN 'INADIMPLENTE'
             ELSE 'ADIMPLENTE'
             END
